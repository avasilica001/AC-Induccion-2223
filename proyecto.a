;ESTADO		EQU
;EVENTO		EQU	
LED_R		EQU	P2.0
BUZZER		EQU	P2.1
MAS_BTN		EQU	P3.0
MENOS_BTN	EQU	P3.1
ONOFF_BTN	EQU	P3.2
SENSOR		EQU	P3.3
;ADC_TEMP	EQU	P5.0
DISPLAY		EQU	0X30
DP_A		EQU	P0.0
DP_B		EQU	P0.1
DP_C		EQU	P0.2
DP_D		EQU	P0.3
DP_E		EQU	P0.4
DP_F		EQU	P0.5
DP_G		EQU	P0.6
ESTADO		EQU	0X20
EVENTO		EQU	0X21


	AJMP 	INICIO

;ORG 0X7B

INICIO:
	ACALL 	INICIALIZACIONES

BUCLE:
	ACALL 	MAQUINAESTADOS
	AJMP	BUCLE

INICIALIZACIONES:

; 	MOV	A,#12	Probar que debugea bien
	MOV	ESTADO,#0
	MOV	EVENTO,#0
	CLR	A
	CLR	BUZZER
	CLR	MAS_BTN
	CLR	MENOS_BTN
	CLR	ONOFF_BTN
	CLR	DP_A
	CLR	DP_B
	CLR	DP_C
	CLR	DP_D 
	CLR	DP_E
	CLR	DP_F
	CLR	DP_G
	CLR	LED_R
;	CLR	ADC_TEMP

	RET


MAQUINAESTADOS:

	MOV	A,ESTADO
	RL	A
	MOV 	DPTR,#EST_TABL
	JMP 	@A+DPTR

EST_TABL:
	AJMP	ESTADO0


;***********************************************ESTADO 0 --> REPOSO
ESTADO0:

	ACALL	GEN_EVE0
	MOV	A,EVENTO
	RL 	A; ROTA ACUM A LA IZQ
	MOV 	DPTR,#EV0_TBL
	JMP 	@A+DPTR

EV0_TBL:

	AJMP 	EV00_ESPERA ;EVENTO VACIO
	AJMP 	EV01_PULSADOON ;EVENTO AL PULSAR EL BOTON ON

	

GEN_EVE0:
	;SI SE HA PULSADO EL BOTON DE ON
	JB 	ONOFF_BTN, EV01_PULSADOON
	RET


EV00_ESPERA:
	RET

EV01_PULSADOON:
	CLR 	ONOFF_BTN
	ACALL	MOSTRAR_DP_0 ;SIN PARPADEO 
	ACALL	LED
	ACALL	PITIDO
	MOV	ESTADO, #0X01
	RET


;***********************************************ESTADO 1 --> ENCENDIDO
ESTADO1:

        ACALL	GEN_EVE1
        MOV 	A,EVENTO
        RL 	A
        MOV 	DPTR,#EV1_TABL
        JMP 	@A+DPTR


EV1_TABL:
        
	;AJMP 	EV0
        ;AJMP 	EV11

GEN_EVE1:

	RET

EVE11:

	;ACALL	PARPADEO_DP;SE INICIA EL TIMER15S Y SE TIENE EN CUENTA LOS 500MS ENCENDIDO Y 500MS APAGADO



LED:
	RET

PITIDO:
	RET

MOSTRAR_DP_0:
	MOV A, #0
	ACALL BCD_7SEG
	MOV DISPLAY, A
	MOV P0, DISPLAY
	RET


BCD_7SEG:
	INC 	A
	MOVC 	A,@A+PC
	RET
	DB 	00111111b
	DB 	00000110B
	DB 	01011011B
	DB 	01001111B
	DB 	01100110b
	DB 	01101101B
	DB 	01111101B
	DB 	00000111B
	DB 	01111111B
	DB 	01100111B


END


